[TOC]



# Decision procedure for LA 线性运算的决策过程

## 介绍

针对于求解线性约束之合取；例如：

$3x_1+2x_2\le5x_3\;\wedge \;2x_1-2x_2=0$

### 线性运算的求解器

线性规划(Linear Program):带有目标和约束，如果去除约束，仅关心判定版本，则使用泛化的**单纯型算法**（general Simplex）

整数线性规划(ILP):**分支定界**（branch and bound）

以上2种算法对于大规模算例高效，在小例子上，介绍2种其他算法：**Fourier-Motzkin**变量消除用于LP，**Omega Test**用于ILP

##单纯形算法

### 规范式

接受2种约束作为输入：

1.等式：$a_1x_1+...+a_nx_n=0$

2.变量的上下界：$l_i\le x_i\le u_i$($l_i,u_i$是常数)

可以引入新变量来描述约束  $L'\le b$：$L'-s_i=0, s_i\le b$

新变量$s_1,s_2...$被称为附加变量，原约束中的变量$x_1,x_2$是问题变量

###单纯形法基础

不等式对应着一个半平面，等式对应着一个超平面，可行域对应着它们的交集

通常将m个约束，n个变量的问题输入表示为矩阵A(m*m+n)

$Ax=0\; and \;\wedge_{i=1}^ml_i\le s_i\le u_i$

可以将A进一步简化为m*n的tableau，列对应非基变量，行对应基变量

举例：$x+y\ge2\wedge \\2x-y\ge0\\-x+2y\ge1$先添加附加变量转化为$x+y-s_1=0\\2x-y-s_2=0\\-x+2y-s_3=0\\s_1\ge 2\\s_2\ge0\\s_3\ge 1$

|       | x    | y    |
| ----- | ---- | ---- |
| $s_1$ | 1    | 1    |
| $s_2$ | 2    | -1   |
| $s_3$ | -1   | 2    |

### 带上下界的单纯形算法

**初始化：**

1.所有附加变量设为基变量

2.所有问题变量设为非基变量

3.所有问题变量赋值为0

**在搜索过程中**保持2个不变量：1.$Ax=0$     2.所有**非基变量**处于其上下界内

搜索过程是在反复检测是否有**基变量**超过边界，如果没有，算法就返回SAT

如果有，假设是基变量$\alpha(x_i)>u_i$ 由于$x_i=\sum_{x_j\in N}a_{ij}x_j$,则为了缩小其赋值，需要选取($x_j>l_j$的非基变量)，减少$\alpha_{ij}>0$对应的$x_j$的取值

变化量为$\theta=\frac{u_i-\alpha(x_i)}{a_{ij}}$ 变化$x_j$后，可以将$x_i$置于其界内，但是可能会让$x_j$超出界，因此要交换$x_i,x_j$，使$x_i$为非基(换入)，$x_j$为基变量(换出)。

**锚点操作**

锚点元素：给定2个变量$x_i,x_j$，系数$a_{ij}$是锚点元素

锚点列：$x_j$所在的列，锚点行：$x_i$所在的行

操作：1.为$x_j$求解第i行

2.对于所有不等于i的行$l\not=i$,用从i行获得的等式来消除$x_j$

举例：上述例子中

|       | x    | y    |
| ----- | ---- | ---- |
| $s_1$ | 1    | 1    |
| $s_2$ | 2    | -1   |
| $s_3$ | -1   | 2    |

$2\le s1\\0\le s_2\\1\le s_3$ 其中，目前$x,y,x$的赋值为0，$s_1=0$小于其下界，由于x的系数>0,且x没有上界，因此可以将x增大2，并将s1变为非基变量，将x变为基变量

首先**第一步**是求解s1的行，即$s_1=x+y\leftrightarrow x=s_1-y$

**第二步**是将x用s1在其他2行中替代：$s_2=2(s_1-y)-y\leftrightarrow s_2=2s_1-3y\\s_3=-(s_1-y)+2y\leftrightarrow s_3=-s_1+3y$

|       | $s_1$ | y    |
| ----- | ----- | ---- |
| $x$   | 1     | -1   |
| $s_2$ | 2     | -3   |
| $s_3$ | -1    | 3    |

对应的赋值为$\alpha(x)=2\\\alpha(y)=0\\\alpha(s_1)=2\\\alpha(s_2)=4\\\alpha(s_3)=-2$

此时$s_3$的界被违反了，则要变化增大y，变化的量为$\theta=\frac{1-(-2)}{3}=1$

在执行完锚点操作后，tableau为

|       | $s_1$ | $s_3$ |
| ----- | ----- | ----- |
| $x$   | 2/3   | -1/3  |
| $s_2$ | 1     | -1    |
| $y$   | 1/3   | 1/3   |

此时各个基变量的赋值都在界内，因此返回可满足

保证固定顺序选锚点可以确保基变量集合不会重复，因此不会出现循环，因此算法会终止

### 增量式问题

公式会被加强，即加入新的合取式

1.任何约束可以被消除，通过移除其上下界

2.锚点操作是等式操作，它保留了解集合，因而可以从之前的界的tableau中开始

3.如果非基变量加入上下界，则其值要相应的变化，并根据tableau改变非基变量的赋值

4.如果要移除约束，移除一个约束后，赋值要恢复到满足2个不变量，可以将赋值恢复到最后已知的可满足的赋值

## 分支定界法

在LP的基础上要求解要取整数值

首先定义松弛版本的问题：基去除整数约束的限制

分支定界的方式会反复调用泛化的单纯形算法来求解松弛版本，根据单纯形法输出的解。

如果输出的解中包含非整数解，则将问题分成2个子问题，并迭代调用

该方法是不完备算法，因为可能会永远分支（例：如果没有整数解，但是有无界的实数解）就会不断地分支

为了使得算法变得完备，需要使用small-model理论：即如果存在一个可满足的解，也存在一个在有限域内的解，一旦找到了每个变量的界，就存在有限域内的解。一旦找到了每个变量的界，一旦超过了界，我们可以停止搜索这一个解。

通过添加精确约束，可以保证终止。

### 切平面

切平面是用来移除非整数解，添加约束来替身求解的松弛的紧度，从而让分支定界法更快，branch and cut

切平面：不会移除任何整数解的约束。

例子:假设有整数变量$x_1,x_2,x_3$，其中$1\le x_1,0.5\le x_2$，假设单纯形算法中包含$x_3=0.5x_1+2.5x_2$,当前解为$\{x_3\rightarrow 1.75,x_1\rightarrow 1,x_2\rightarrow 0.5\}$

由于单纯形算法表：$x_3-1.75=0.5(x_1-1)+2.5(x_2-0.5)$

则可以改写为$x_3-1=0.75+0.5(x_1-1)+2.5(x_2-0.5)$

由于左侧是一个大于0的整数，因此$0.75+0.5(x_1-1)+2.5(x_2-0.5)\ge1$目前的解的情况是该式子不成立，因此可以禁掉当前解，但由于是通过整数推导出，并不会移除整数解。

使用切平面法的两个条件：1.基变量的赋值是分数的  2.所有非基变量都达到了其中的一个界

## FM变量消解

### 等式消解

假设存在如下的等式$\sum _{j=1}^n a_{i,j}x_j=b_i$

则$x_n=\frac{b_i}{a_{i,n}}-\sum^{n-1}_{j=1}\frac{a_{i,j}}{a_{i,n}}*x_j$ 将右式替代$x_n$到所有其他的约束中，并移除本约束，只剩下不等式

### 变量消解

将目前的问题投影到少一个变量的问题上，会添加更多的约束

预设变量消除的顺序，优先选择产生更少约束的变量

设第i号约束为$\sum _{j=1}^n a_{i,j}x_j\le b_i$ 则若$a_{i,n}>0$，$x_n\le \frac{b_i}{a_{i,n}}-\sum^{n-1}_{j=1}\frac{a_{i,j}}{a_{i,n}}*x_j$

右式为$x_n$的上界，如果$a_{i,n}<0$右式为$x_n$的下界。

### 无界变量

如果一个变量仅有上界或者下界，则这些变量为无界的，移除这些变量及其相关约束

### 有界变量

如果$x_n$有上界下界，则会枚举所有的上下界对，对于每对上下界，$\beta_l\le x_n\le \beta_u$

会添加新的约束$\beta_l\le \beta_u$ ,并将所有包含$x_n$的约束全部去除

例子：$x_1-x_2\le0\\x_1-x_3\le 0\\-x_1+x_2+2x_3\le 0\\-x_3\le-1$

对于$x_1$有2个上界$x_1\le x_2,x-1\le x_3$,一个下界$x_2+2x_3\le x_1$

将$x_1\le x_2$作为上界，可得到$2x_3\le 0$；将$x_1\le x_3$作为上界，可以得到**$x_1\le x_3$** 

去除所有包含$x_1$的约束，可以得到如下约束$2x_3\le 0\\x_2+x_3\le 0\\-x_3\le -1$

其中$x_2$没有下界，因此可以删除，得到$2x_3\le 0\\-x_3\le -1$ 存在矛盾，相比于单纯性算法，仅允许$\le$，FM消除可以允许$<$,如果上下界之一存在$<$,则结果约束也存在<

## Omega Test

针对整数变量,可视为FM消解的变种

## 预处理

1.如果$\sum_{j|a_j>0}a_ju_j+\sum_{j|a_j<0}a_jl_j\le b$，则约束$\sum_{j=0}^n a_jx_j\le b$为多余的约束

即，和的最大值如果不超过约束中的常数项，则该约束是多余的

2.如果推出的界比原来的界更紧，则原来的界可以加强

3.对整数系统的的预处理：将系数化为整数，将<化为$\le$

